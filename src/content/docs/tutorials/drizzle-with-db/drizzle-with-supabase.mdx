---
title: "Supabase ë°ì´í„°ë² ì´ìŠ¤ì™€ Drizzle ì‚¬ìš©í•˜ê¸°"
date: "2024-05-07"
svgs: ['<svg width="160" height="160" viewBox="0 0 160 160" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="9.63139" height="40.8516" rx="4.8157" transform="matrix(0.873028 0.48767 -0.497212 0.867629 43.4805 67.3037)" fill="currentColor"></rect><rect width="9.63139" height="40.8516" rx="4.8157" transform="matrix(0.873028 0.48767 -0.497212 0.867629 76.9395 46.5342)" fill="currentColor"></rect><rect width="9.63139" height="40.8516" rx="4.8157" transform="matrix(0.873028 0.48767 -0.497212 0.867629 128.424 46.5352)" fill="currentColor"></rect><rect width="9.63139" height="40.8516" rx="4.8157" transform="matrix(0.873028 0.48767 -0.497212 0.867629 94.957 67.3037)" fill="currentColor"></rect></svg>', <svg width="24" height="25" viewBox="0 0 24 25" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M13.3501 21.1611C12.9303 21.6898 12.079 21.4002 12.0689 20.7251L11.921 10.8511H18.5603C19.7628 10.8511 20.4335 12.24 19.6857 13.1818L13.3501 21.1611Z" /><path d="M10.6499 5.27307C11.0697 4.7443 11.921 5.03403 11.9311 5.70913L11.996 15.5831H5.43981C4.23723 15.5831 3.56652 14.1942 4.31432 13.2524L10.6499 5.27307Z"/></svg>']
---

import Prerequisites from "@mdx/Prerequisites.astro";
import Npm from '@mdx/Npm.astro';
import Steps from '@mdx/Steps.astro';
import Section from "@mdx/Section.astro";
import Callout from '@mdx/Callout.astro';

## Supabaseì™€ Drizzle ORM ì„¤ì •í•˜ê¸°

ì´ íŠœí† ë¦¬ì–¼ì€ [Supabase ë°ì´í„°ë² ì´ìŠ¤](https://supabase.com/docs/guides/database/overview)ì™€ í•¨ê»˜ Drizzle ORMì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ëª¨ë“  Supabase í”„ë¡œì íŠ¸ëŠ” ì™„ì „í•œ [Postgres](https://www.postgresql.org/) ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

<Prerequisites>
- Drizzle ORMê³¼ [Drizzle Kit](/docs/kit-overview)ì„ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
<Npm>
drizzle-orm
-D drizzle-kit
</Npm>
- í™˜ê²½ ë³€ìˆ˜ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ `dotenv` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ì´ íŒ¨í‚¤ì§€ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](https://www.npmjs.com/package/dotenv)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<Npm>
  dotenv
</Npm>

- Postgres ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ê¸° ìœ„í•´ `postgres` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ì´ íŒ¨í‚¤ì§€ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](https://www.npmjs.com/package/postgres)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<Npm>
  postgres
</Npm>

- ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìœ„í•´ Supabase CLIë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ìµœì‹  ë²„ì „ì˜ [Supabase CLI](https://supabase.com/docs/guides/cli/getting-started#installing-the-supabase-cli)ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
</Prerequisites>

Drizzle ORMì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ëŠ” ë°©ë²•ì€ [Supabase ë¬¸ì„œ](https://supabase.com/docs/guides/database/connecting-to-postgres#connecting-with-drizzle)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<Steps>


#### ìƒˆë¡œìš´ Supabase í”„ë¡œì íŠ¸ ìƒì„±í•˜ê¸°

ìƒˆë¡œìš´ Supabase í”„ë¡œì íŠ¸ëŠ” [ëŒ€ì‹œë³´ë“œ](https://supabase.com/dashboard)ì—ì„œ ìƒì„±í•˜ê±°ë‚˜, ì´ [ë§í¬](https://database.new/)ë¥¼ ë”°ë¼ê°€ë©´ ë°”ë¡œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


#### ì—°ê²° ë¬¸ìì—´ ë³€ìˆ˜ ì„¤ì •í•˜ê¸°

1. [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •](https://supabase.com/dashboard/project/_/settings/database) í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. `Connection String` ì„¹ì…˜ì—ì„œ URIë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤. ì´ë•Œ, **ì—°ê²° í’€ë§(connection pooling)**ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
3. ë³µì‚¬í•œ ì—°ê²° ë¬¸ìì—´ì—ì„œ ë¹„ë°€ë²ˆí˜¸ ë¶€ë¶„ì„ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.

4. `.env` ë˜ëŠ” `.env.local` íŒŒì¼ì— `DATABASE_URL` ë³€ìˆ˜ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```plaintext copy
DATABASE_URL=
```

ì—°ê²° í’€ëŸ¬(Connection Pooler)ì™€ í’€ë§ ëª¨ë“œì— ëŒ€í•´ ë” ìì„¸íˆ ì•Œê³  ì‹¶ë‹¤ë©´ [ê³µì‹ ë¬¸ì„œ](https://supabase.com/docs/guides/database/connecting-to-postgres#connection-pooler)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.


#### Drizzle ORMì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ê¸°

`src/db` ë””ë ‰í† ë¦¬ì— `index.ts` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •ì„ êµ¬ì„±í•©ë‹ˆë‹¤:

```typescript
import { config } from 'dotenv';
import { drizzle } from 'drizzle-orm/postgres-js';
import postgres from 'postgres';

// .env ë˜ëŠ” .env.local íŒŒì¼ì—ì„œ í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
config({ path: '.env' });

// ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í´ë¼ì´ì–¸íŠ¸ ìƒì„±
const client = postgres(process.env.DATABASE_URL!);

// Drizzle ORM ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ë‚´ë³´ë‚´ê¸°
export const db = drizzle({ client });
```

ì´ ì½”ë“œëŠ” Drizzle ORMì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ëŠ” ê¸°ë³¸ ì„¤ì •ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. `.env` íŒŒì¼ì—ì„œ `DATABASE_URL` í™˜ê²½ ë³€ìˆ˜ë¥¼ ì½ì–´ì™€ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ê³ , ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Drizzle ORM ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.


#### í…Œì´ë¸” ìƒì„±í•˜ê¸°

`src/db` ë””ë ‰í† ë¦¬ì— `schema.ts` íŒŒì¼ì„ ìƒì„±í•˜ê³  í…Œì´ë¸”ì„ ì„ ì–¸í•©ë‹ˆë‹¤:

```typescript
import { integer, pgTable, serial, text, timestamp } from 'drizzle-orm/pg-core';

// ì‚¬ìš©ì í…Œì´ë¸” ì •ì˜
export const usersTable = pgTable('users_table', {
  id: serial('id').primaryKey(), // ê¸°ë³¸ í‚¤ë¡œ ì„¤ì •ëœ ìë™ ì¦ê°€ ID
  name: text('name').notNull(), // ì´ë¦„ (í•„ìˆ˜)
  age: integer('age').notNull(), // ë‚˜ì´ (í•„ìˆ˜)
  email: text('email').notNull().unique(), // ì´ë©”ì¼ (í•„ìˆ˜, ê³ ìœ ê°’)
});

// ê²Œì‹œë¬¼ í…Œì´ë¸” ì •ì˜
export const postsTable = pgTable('posts_table', {
  id: serial('id').primaryKey(), // ê¸°ë³¸ í‚¤ë¡œ ì„¤ì •ëœ ìë™ ì¦ê°€ ID
  title: text('title').notNull(), // ì œëª© (í•„ìˆ˜)
  content: text('content').notNull(), // ë‚´ìš© (í•„ìˆ˜)
  userId: integer('user_id') // ì‚¬ìš©ì ID (í•„ìˆ˜)
    .notNull()
    .references(() => usersTable.id, { onDelete: 'cascade' }), // ì‚¬ìš©ì í…Œì´ë¸”ì˜ ID ì°¸ì¡°, ì‚­ì œ ì‹œ ì—°ì‡„ ì‚­ì œ
  createdAt: timestamp('created_at').notNull().defaultNow(), // ìƒì„± ì‹œê°„ (í•„ìˆ˜, ê¸°ë³¸ê°’ í˜„ì¬ ì‹œê°„)
  updatedAt: timestamp('updated_at') // ìˆ˜ì • ì‹œê°„ (í•„ìˆ˜)
    .notNull()
    .$onUpdate(() => new Date()), // ì—…ë°ì´íŠ¸ ì‹œ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ìë™ ì„¤ì •
});

// ì‚¬ìš©ì í…Œì´ë¸”ì˜ ì‚½ì… íƒ€ì… ì •ì˜
export type InsertUser = typeof usersTable.$inferInsert;
// ì‚¬ìš©ì í…Œì´ë¸”ì˜ ì„ íƒ íƒ€ì… ì •ì˜
export type SelectUser = typeof usersTable.$inferSelect;

// ê²Œì‹œë¬¼ í…Œì´ë¸”ì˜ ì‚½ì… íƒ€ì… ì •ì˜
export type InsertPost = typeof postsTable.$inferInsert;
// ê²Œì‹œë¬¼ í…Œì´ë¸”ì˜ ì„ íƒ íƒ€ì… ì •ì˜
export type SelectPost = typeof postsTable.$inferSelect;
```


#### Drizzle ì„¤ì • íŒŒì¼ ì„¤ì •í•˜ê¸°

**Drizzle ì„¤ì • íŒŒì¼**ì€ [Drizzle Kit](/docs/kit-overview)ì—ì„œ ì‚¬ìš©í•˜ëŠ” êµ¬ì„± íŒŒì¼ë¡œ, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´, ë§ˆì´ê·¸ë ˆì´ì…˜ í´ë”, ìŠ¤í‚¤ë§ˆ íŒŒì¼ ë“±ì— ëŒ€í•œ ëª¨ë“  ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `drizzle.config.ts` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•˜ì„¸ìš”:

```typescript copy filename="drizzle.config.ts"
import { config } from 'dotenv';
import { defineConfig } from 'drizzle-kit';

// .env íŒŒì¼ì—ì„œ í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
config({ path: '.env' });

export default defineConfig({
  schema: './src/db/schema.ts', // ìŠ¤í‚¤ë§ˆ íŒŒì¼ ê²½ë¡œ
  out: './supabase/migrations', // ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì¶œë ¥ ê²½ë¡œ
  dialect: 'postgresql', // ë°ì´í„°ë² ì´ìŠ¤ ì¢…ë¥˜
  dbCredentials: {
    url: process.env.DATABASE_URL!, // ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° URL
  },
});
```

ì´ ì„¤ì • íŒŒì¼ì€ Drizzle Kitì´ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ê´€ë¦¬í•˜ê³  ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìƒì„±í•˜ëŠ” ë° í•„ìš”í•œ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.


#### ë°ì´í„°ë² ì´ìŠ¤ì— ë³€ê²½ ì‚¬í•­ ì ìš©í•˜ê¸°

`drizzle-kit generate` ì»¤ë§¨ë“œë¥¼ ì‚¬ìš©í•´ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìƒì„±í•˜ê³ , `drizzle-kit migrate` ì»¤ë§¨ë“œë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±:

```bash
npx drizzle-kit generate
```

ì´ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ `drizzle.config.ts`ì— ì§€ì •ëœ ëŒ€ë¡œ `supabase/migrations` ë””ë ‰í† ë¦¬ì— ì €ì¥ë©ë‹ˆë‹¤. ì´ ë””ë ‰í† ë¦¬ì—ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë° í•„ìš”í•œ SQL íŒŒì¼ê³¼, ë‹¤ì–‘í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„ì—ì„œì˜ ìŠ¤í‚¤ë§ˆ ìŠ¤ëƒ…ìƒ·ì„ ì €ì¥í•˜ëŠ” `meta` í´ë”ê°€ í¬í•¨ë©ë‹ˆë‹¤.

ìƒì„±ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ˆì œ:

```sql
CREATE TABLE IF NOT EXISTS "posts_table" (
	"id" serial PRIMARY KEY NOT NULL,
	"title" text NOT NULL,
	"content" text NOT NULL,
	"user_id" integer NOT NULL,
	"created_at" timestamp DEFAULT now() NOT NULL,
	"updated_at" timestamp NOT NULL
);
--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "users_table" (
	"id" serial PRIMARY KEY NOT NULL,
	"name" text NOT NULL,
	"age" integer NOT NULL,
	"email" text NOT NULL,
	CONSTRAINT "users_table_email_unique" UNIQUE("email")
);
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "posts_table" ADD CONSTRAINT "posts_table_user_id_users_table_id_fk" FOREIGN KEY ("user_id") REFERENCES "users_table"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
```

ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰:

```bash
npx drizzle-kit migrate
```

[ë§ˆì´ê·¸ë ˆì´ì…˜ í”„ë¡œì„¸ìŠ¤](/docs/migrations)ì— ëŒ€í•´ ë” ì•Œì•„ë³´ì„¸ìš”. ë˜í•œ [Supabase CLI](https://supabase.com/docs/guides/cli/getting-started)ë¥¼ ì‚¬ìš©í•´ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:
- ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í…Œì´ë¸”ì˜ ê²½ìš°, `npx drizzle-kit generate`ë¡œ ìƒì„±ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ìˆ˜ë™ìœ¼ë¡œ ê²€í† í•˜ê³ , ì•ˆì „í•˜ì§€ ì•Šì€ ìˆœìˆ˜ ìƒì„± êµ¬ë¬¸(ì˜ˆ: `CREATE SCHEMA "auth";`)ì„ ì£¼ì„ ì²˜ë¦¬í•˜ê±°ë‚˜ ì¡°ì •í•´ì•¼ í•©ë‹ˆë‹¤. ë™ì‹œì— ì•ˆì „í•œ ì¡°ê±´ë¶€ ìƒì„± êµ¬ë¬¸(ì˜ˆ: `CREATE TABLE IF NOT EXISTS "auth"."users"`)ì´ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬ë˜ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.

ë˜ëŠ” [Drizzle kit push ì»¤ë§¨ë“œ](/docs/kit-overview#prototyping-with-db-push)ë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì§ì ‘ ë³€ê²½ ì‚¬í•­ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
npx drizzle-kit push
```

<Callout type="warning">í‘¸ì‹œ ì»¤ë§¨ë“œëŠ” ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ ìƒˆë¡œìš´ ìŠ¤í‚¤ë§ˆ ë””ìì¸ì´ë‚˜ ë³€ê²½ ì‚¬í•­ì„ ë¹ ë¥´ê²Œ í…ŒìŠ¤íŠ¸í•´ì•¼ í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤. ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ê´€ë¦¬í•˜ëŠ” ì˜¤ë²„í—¤ë“œ ì—†ì´ ë¹ ë¥´ê²Œ ë°˜ë³µ ì‘ì—…ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</Callout>

Supabase CLIë¥¼ ì‚¬ìš©í•´ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì ìš©í•˜ë ¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¥´ì„¸ìš”:

Drizzle Kitë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±:

```bash
npx drizzle-kit generate
```

ë¡œì»¬ Supabase í”„ë¡œì íŠ¸ ì´ˆê¸°í™”:

```bash
supabase init
```

ì›ê²© í”„ë¡œì íŠ¸ì™€ ì—°ê²°:

```bash
supabase link
```

ë°ì´í„°ë² ì´ìŠ¤ì— ë³€ê²½ ì‚¬í•­ ì ìš©:

```bash
supabase db push
```
</Steps>

## ê¸°ë³¸ íŒŒì¼ êµ¬ì¡°

ì´ í”„ë¡œì íŠ¸ì˜ ê¸°ë³¸ íŒŒì¼ êµ¬ì¡°ì…ë‹ˆë‹¤. `src/db` ë””ë ‰í† ë¦¬ì—ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ íŒŒì¼ë“¤ì´ ìœ„ì¹˜í•˜ë©°, `index.ts` íŒŒì¼ì—ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì •ì´, `schema.ts` íŒŒì¼ì—ëŠ” ìŠ¤í‚¤ë§ˆ ì •ì˜ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```plaintext
ğŸ“¦ <project root>
 â”œ ğŸ“‚ src
 â”‚   â”œ ğŸ“‚ db
 â”‚   â”‚  â”œ ğŸ“œ index.ts
 â”‚   â”‚  â”” ğŸ“œ schema.ts
 â”œ ğŸ“‚ supabase
 â”‚   â”œ ğŸ“‚ migrations
 â”‚   â”‚  â”œ ğŸ“‚ meta
 â”‚   â”‚  â”‚  â”œ ğŸ“œ _journal.json
 â”‚   â”‚  â”‚  â”” ğŸ“œ 0000_snapshot.json
 â”‚   â”‚  â”” ğŸ“œ 0000_watery_spencer_smythe.sql
 â”‚   â”” ğŸ“œ config.toml
 â”œ ğŸ“œ .env
 â”œ ğŸ“œ drizzle.config.ts
 â”œ ğŸ“œ package.json
 â”” ğŸ“œ tsconfig.json
```


## ì¿¼ë¦¬ ì˜ˆì œ

ì˜ˆë¥¼ ë“¤ì–´, `src/db/queries` í´ë”ë¥¼ ìƒì„±í•˜ê³  ê° ì‘ì—…(ì‚½ì…, ì„ íƒ, ì—…ë°ì´íŠ¸, ì‚­ì œ)ë³„ë¡œ íŒŒì¼ì„ ë¶„ë¦¬í•©ë‹ˆë‹¤.


#### ë°ì´í„° ì‚½ì…

ë°ì´í„° ì‚½ì… ì¿¼ë¦¬ì— ëŒ€í•´ ë” ì•Œì•„ë³´ë ¤ë©´ [ë¬¸ì„œ](/docs/insert)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

```typescript copy filename="src/db/queries/insert.ts" {4, 8}
import { db } from '../index';
import { InsertPost, InsertUser, postsTable, usersTable } from '../schema';

export async function createUser(data: InsertUser) {
  await db.insert(usersTable).values(data);
}

export async function createPost(data: InsertPost) {
  await db.insert(postsTable).values(data);
}
```


#### ë°ì´í„° ì„ íƒí•˜ê¸°

ì„ íƒ ì¿¼ë¦¬ì— ëŒ€í•œ ë” ìì„¸í•œ ë‚´ìš©ì€ [ë¬¸ì„œ](/docs/select)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```typescript copy filename="src/db/queries/select.ts" {5, 16, 41}
import { asc, between, count, eq, getTableColumns, sql } from 'drizzle-orm';
import { db } from '../index';
import { SelectUser, postsTable, usersTable } from '../schema';

// íŠ¹ì • IDë¥¼ ê°€ì§„ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
export async function getUserById(id: SelectUser['id']): Promise<
  Array<{
    id: number;
    name: string;
    age: number;
    email: string;
  }>
> {
  return db.select().from(usersTable).where(eq(usersTable.id, id));
}

// ì‚¬ìš©ìì™€ ê·¸ë“¤ì˜ ê²Œì‹œë¬¼ ìˆ˜ë¥¼ í•¨ê»˜ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
export async function getUsersWithPostsCount(
  page = 1,
  pageSize = 5,
): Promise<
  Array<{
    postsCount: number;
    id: number;
    name: string;
    age: number;
    email: string;
  }>
> {
  return db
    .select({
      ...getTableColumns(usersTable),
      postsCount: count(postsTable.id),
    })
    .from(usersTable)
    .leftJoin(postsTable, eq(usersTable.id, postsTable.userId))
    .groupBy(usersTable.id)
    .orderBy(asc(usersTable.id))
    .limit(pageSize)
    .offset((page - 1) * pageSize);
}

// ì§€ë‚œ 24ì‹œê°„ ë™ì•ˆ ì‘ì„±ëœ ê²Œì‹œë¬¼ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
export async function getPostsForLast24Hours(
  page = 1,
  pageSize = 5,
): Promise<
  Array<{
    id: number;
    title: string;
  }>
> {
  return db
    .select({
      id: postsTable.id,
      title: postsTable.title,
    })
    .from(postsTable)
    .where(between(postsTable.createdAt, sql`now() - interval '1 day'`, sql`now()`))
    .orderBy(asc(postsTable.title), asc(postsTable.id))
    .limit(pageSize)
    .offset((page - 1) * pageSize);
}
```

ë˜ëŠ” [ê´€ê³„í˜• ì¿¼ë¦¬ ë¬¸ë²•](/docs/rqb)ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.


#### ë°ì´í„° ì—…ë°ì´íŠ¸

ë°ì´í„° ì—…ë°ì´íŠ¸ ì¿¼ë¦¬ì— ëŒ€í•´ ë” ì•Œì•„ë³´ë ¤ë©´ [ë¬¸ì„œ](/docs/update)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

```typescript copy filename="src/db/queries/update.ts" {5}
import { eq } from 'drizzle-orm';
import { db } from '../index';
import { SelectPost, postsTable } from '../schema';

export async function updatePost(id: SelectPost['id'], data: Partial<SelectPost>) {
  await db.update(postsTable).set(data).where(eq(postsTable.id, id));
}
```

ìœ„ ì½”ë“œëŠ” `postsTable`ì—ì„œ íŠ¹ì • IDë¥¼ ê°€ì§„ ê²Œì‹œë¬¼ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. `db.update` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³ , `eq` í•¨ìˆ˜ë¥¼ í†µí•´ íŠ¹ì • IDë¥¼ ì¡°ê±´ìœ¼ë¡œ ì§€ì •í•©ë‹ˆë‹¤.


#### ë°ì´í„° ì‚­ì œ

ì‚­ì œ ì¿¼ë¦¬ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ë¬¸ì„œ](/docs/delete)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```typescript copy filename="src/db/queries/delete.ts" {5}
import { eq } from 'drizzle-orm';
import { db } from '../index';
import { SelectUser, usersTable } from '../schema';

export async function deleteUser(id: SelectUser['id']) {
  await db.delete(usersTable).where(eq(usersTable.id, id));
}
```


