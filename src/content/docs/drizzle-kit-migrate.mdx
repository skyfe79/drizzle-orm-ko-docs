import CodeTab from "@mdx/CodeTab.astro";
import CodeTabs from "@mdx/CodeTabs.astro";
import Section from "@mdx/Section.astro";
import Tab from "@mdx/Tab.astro";
import Tabs from "@mdx/Tabs.astro";
import Callout from "@mdx/Callout.astro";
import Prerequisites from "@mdx/Prerequisites.astro";
import Npx from "@mdx/Npx.astro";

# `drizzle-kit migrate`

<Prerequisites>
- Drizzleì™€ `drizzle-kit` ì‹œì‘í•˜ê¸° - [ì—¬ê¸°ì„œ ì½ê¸°](/docs/get-started)
- Drizzle ìŠ¤í‚¤ë§ˆ ê¸°ë³¸ ê°œë… - [ì—¬ê¸°ì„œ ì½ê¸°](/docs/sql-schema-declaration)
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ê¸°ë³¸ ì‚¬í•­ - [ì—¬ê¸°ì„œ ì½ê¸°](/docs/connect-overview)
- Drizzle ë§ˆì´ê·¸ë ˆì´ì…˜ ê¸°ë³¸ ê°œë… - [ì—¬ê¸°ì„œ ì½ê¸°](/docs/migrations)
- Drizzle Kit [ê°œìš”](/docs/kit-overview) ë° [ì„¤ì • íŒŒì¼](/docs/drizzle-config-file)
- `drizzle-kit generate` ì»¤ë§¨ë“œ - [ì—¬ê¸°ì„œ ì½ê¸°](/docs/drizzle-kit-generate)
</Prerequisites>
<br/>

`drizzle-kit migrate`ëŠ” [`drizzle-kit generate`](/docs/drizzle-kit-generate)ë¡œ ìƒì„±ëœ SQL ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì´ ëª…ë ¹ì–´ëŠ” Drizzle ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ê´€ë¦¬í•˜ëŠ” [ì½”ë“œ ìš°ì„ (ì˜µì…˜ 3)](/docs/migrations) ì ‘ê·¼ ë°©ì‹ì„ ë‹¤ë£¹ë‹ˆë‹¤.

<Callout collapsed="ë‚´ë¶€ ë™ì‘ ì›ë¦¬">
Drizzle Kit `migrate` ëª…ë ¹ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì¼ë ¨ì˜ ì´ë²¤íŠ¸ë¥¼ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤:
1. ë§ˆì´ê·¸ë ˆì´ì…˜ í´ë”ë¥¼ ì½ê³  ëª¨ë“  `.sql` ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ í™•ì¸í•©ë‹ˆë‹¤.
2. ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ê³  Drizzle ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œê·¸ í…Œì´ë¸”ì—ì„œ í•­ëª©ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
3. ì´ì „ì— ì ìš©ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒˆë¡œìš´ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ê²°ì •í•©ë‹ˆë‹¤.
4. SQL ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤í–‰í•˜ê³  ì ìš©ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ Drizzle ë§ˆì´ê·¸ë ˆì´ì…˜ í…Œì´ë¸”ì— ê¸°ë¡í•©ë‹ˆë‹¤.

<Section>
```plaintext
  â”œ ğŸ“‚ drizzle       
  â”‚ â”œ ğŸ“‚ _meta
  â”‚ â”œ ğŸ“œ 0000_premium_mister_fear.sql
  â”‚ â”” ğŸ“œ 0001_delicate_professor_xavie.sql
  â”” â€¦
```
```plaintext
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  
â”‚ $ drizzle-kit migrate â”‚                  
â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  
  â”‚                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         
  â”” 1. ë§ˆì´ê·¸ë ˆì´ì…˜ í´ë”ì—ì„œ migration.sql íŒŒì¼ì„ ì½ìŒ       â”‚                          â”‚
    2. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ ê¸°ë¡ì„ ê°€ì ¸ì˜´ ---------> â”‚         DATABASE         â”‚
  â”Œ 3. ì´ì „ì— ì ìš©ë˜ì§€ ì•Šì€ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì„ íƒ <----------- â”‚                          â”‚
  â”” 4. ìƒˆë¡œìš´ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì ìš© ----------> â”‚                          â”‚
                                                            â”‚                          â”‚
                                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
[âœ“] ì™„ë£Œ!        
```
</Section>
</Callout>

`drizzle-kit migrate` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `dialect`ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´ë¥¼ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì´ ì •ë³´ëŠ” [drizzle.config.ts](/docs/drizzle-config-file) ì„¤ì • íŒŒì¼ì„ í†µí•´ ì œê³µí•˜ê±°ë‚˜ CLI ì˜µì…˜ìœ¼ë¡œ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<CodeTabs items={["ì„¤ì • íŒŒì¼ ì‚¬ìš©", "CLI ì˜µì…˜ ì‚¬ìš©"]}>
<Section>
```ts {5,8}
// drizzle.config.ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  dbCredentials: {
    url: "postgresql://user:password@host:port/dbname"
  },
});
```
```shell
npx drizzle-kit migrate
```
</Section>
```shell
npx drizzle-kit migrate --dialect=postgresql --url=postgresql://user:password@host:port/dbname
```
</CodeTabs>


### ë°ì´í„°ë² ì´ìŠ¤ì— ì ìš©ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œê·¸

ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤í–‰í•˜ë©´ Drizzle Kitì€ ì„±ê³µì ìœ¼ë¡œ ì ìš©ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ì— ëŒ€í•œ ê¸°ë¡ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•©ë‹ˆë‹¤. ì´ ê¸°ë¡ì€ `__drizzle_migrations`ë¼ëŠ” ì´ë¦„ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œê·¸ í…Œì´ë¸”ì— ì €ì¥ë©ë‹ˆë‹¤.

ì—¬ëŸ¬ë¶„ì€ Drizzle ì„¤ì • íŒŒì¼ì„ í†µí•´ ì´ í…Œì´ë¸”ì˜ **ì´ë¦„**ê³¼ **ìŠ¤í‚¤ë§ˆ**(PostgreSQL ì „ìš©)ë¥¼ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```ts filename="drizzle.config.ts" {8-9}
export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  dbCredentials: {
    url: "postgresql://user:password@host:port/dbname"
  },
  migrations: {
    table: 'my-migrations-table', // ê¸°ë³¸ê°’ì€ `__drizzle_migrations`
    schema: 'public', // PostgreSQL ì „ìš©, ê¸°ë³¸ê°’ì€ `drizzle`
  },
});
```


### í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ì— ì—¬ëŸ¬ ì„¤ì • íŒŒì¼ ì‚¬ìš©í•˜ê¸°

í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ì—ì„œ ì—¬ëŸ¬ ì„¤ì • íŒŒì¼ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì—¬ëŸ¬ ë°ì´í„°ë² ì´ìŠ¤ ë‹¨ê³„ë‚˜ ë™ì¼í•œ í”„ë¡œì íŠ¸ ë‚´ì—ì„œ ì—¬ëŸ¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê´€ë¦¬í•  ë•Œ ë§¤ìš° ìœ ìš©í•©ë‹ˆë‹¤.

```bash
npx drizzle-kit migrate --config=drizzle-dev.config.ts
npx drizzle-kit migrate --config=drizzle-prod.config.ts
```

```plaintext {5-6}
ğŸ“¦ <project root>
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ src
 â”œ ğŸ“œ .env
 â”œ ğŸ“œ drizzle-dev.config.ts
 â”œ ğŸ“œ drizzle-prod.config.ts
 â”œ ğŸ“œ package.json
 â”” ğŸ“œ tsconfig.json
```

ìœ„ ì˜ˆì œì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, `drizzle-dev.config.ts`ì™€ `drizzle-prod.config.ts`ë¼ëŠ” ë‘ ê°œì˜ ì„¤ì • íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ê°œë°œ í™˜ê²½ê³¼ í”„ë¡œë•ì…˜ í™˜ê²½ì„ ê°ê° ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ í™˜ê²½ì— ë”°ë¼ ë‹¤ë¥¸ ì„¤ì •ì„ ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


### í™•ì¥ ì˜ˆì œ

`drizzle-kit generate`ì™€ `drizzle-kit migrate` ì»¤ë§¨ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ SQL ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìƒì„±í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì— ì ìš©í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```plaintext
ğŸ“¦ <project root>
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ src
 â”‚ â”œ ğŸ“œ schema.ts
 â”‚ â”” ğŸ“œ index.ts
 â”œ ğŸ“œ drizzle.config.ts
 â”” â€¦
```

<CodeTabs items={["drizzle.config.ts", "src/schema.ts"]}>
```ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  dbCredentials: {
    url: "postgresql://user:password@host:port/dbname"
  },
  migrations: {
    table: 'journal', 
    schema: 'drizzle', 
  },
});
```
```ts 
import * as p from "drizzle-orm/pg-core";

export const users = p.pgTable("users", {
  id: p.serial().primaryKey(),
  name: p.text(),
})
```
</CodeTabs>

ì´ì œ ë‹¤ìŒ ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
```shell
npx drizzle-kit generate --name=init
```

ì´ ëª…ë ¹ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ì€ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.
<Section>
```plaintext {5}
ğŸ“¦ <project root>
 â”œ â€¦
 â”œ ğŸ“‚ migrations
 â”‚ â”œ ğŸ“‚ _meta
 â”‚ â”” ğŸ“œ 0000_init.sql 
 â”” â€¦
```
```sql
-- ./drizzle/0000_init.sql

CREATE TABLE "users"(
  id serial primary key,
  name text,
)
```
</Section>

ì´ì œ ë‹¤ìŒ ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
```shell
npx drizzle-kit migrate
```

ì´ì œ SQL ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì„±ê³µì ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤ âœ…


