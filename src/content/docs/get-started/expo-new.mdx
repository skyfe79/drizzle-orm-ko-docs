import Npm from '@mdx/Npm.astro';
import Npx from '@mdx/Npx.astro';
import Callout from '@mdx/Callout.astro';
import Prerequisites from "@mdx/Prerequisites.astro";
import CodeTabs from "@mdx/CodeTabs.astro";
import WhatsNextPostgres from "@mdx/WhatsNextPostgres.astro";
import Breadcrumbs from '@mdx/Breadcrumbs.astro';
import FileStructure from '@mdx/get-started/FileStructure.mdx';
import InstallPackages from '@mdx/get-started/InstallPackages.mdx';
import SetupConfig from '@mdx/get-started/SetupConfig.mdx';
import TransferCode from '@mdx/get-started/TransferCode.mdx';
import QueryDatabase from '@mdx/get-started/QueryDatabase.mdx';
import QueryDatabaseUpdated from '@mdx/get-started/QueryDatabaseUpdated.mdx';
import RunFile from '@mdx/get-started/RunFile.mdx';
import ApplyChanges from '@mdx/get-started/ApplyChanges.mdx';
import SetupEnv from '@mdx/get-started/SetupEnv.mdx';
import CreateTable from '@mdx/get-started/sqlite/CreateTable.mdx';
import ConnectLibsql from '@mdx/get-started/sqlite/ConnectLibsql.mdx';


<Breadcrumbs/>

# Drizzleì™€ Expo ì‹œì‘í•˜ê¸°

<Prerequisites>  
  - **Expo SQLite** - SQLite APIë¥¼ í†µí•´ ì¿¼ë¦¬í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ - [ì—¬ê¸°ì„œ ì½ì–´ë³´ê¸°](https://docs.expo.dev/versions/latest/sdk/sqlite/)
</Prerequisites>


#### 1ë‹¨ê³„ - Expo í…œí”Œë¦¿ìœ¼ë¡œ í”„ë¡œì íŠ¸ ì„¤ì •í•˜ê¸°

<Npx>
create expo-app --template blank-typescript
</Npx>

ì´ í…œí”Œë¦¿ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](https://docs.expo.dev/more/create-expo/#create-a-new-project)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


#### ê¸°ë³¸ íŒŒì¼ êµ¬ì¡°

í…œí”Œë¦¿ì„ ì„¤ì¹˜í•˜ê³  `db` í´ë”ë¥¼ ì¶”ê°€í•œ í›„, ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `db/schema.ts` íŒŒì¼ì—ëŠ” Drizzle í…Œì´ë¸” ì •ì˜ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. `drizzle` í´ë”ì—ëŠ” SQL ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ê³¼ ìŠ¤ëƒ…ìƒ·ì´ ë“¤ì–´ ìˆìŠµë‹ˆë‹¤.

```plaintext
ğŸ“¦ <project root>
 â”œ ğŸ“‚ assets
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ db
 â”‚  â”” ğŸ“œ schema.ts
 â”œ ğŸ“œ .gitignore
 â”œ ğŸ“œ .npmrc
 â”œ ğŸ“œ app.json
 â”œ ğŸ“œ App.tsx
 â”œ ğŸ“œ babel.config.ts
 â”œ ğŸ“œ drizzle.config.ts
 â”œ ğŸ“œ package.json
 â”” ğŸ“œ tsconfig.json
```


#### 2ë‹¨ê³„ - expo-sqlite íŒ¨í‚¤ì§€ ì„¤ì¹˜

<Npx>
expo install expo-sqlite
</Npx>

ìœ„ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ `expo-sqlite` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. ì´ íŒ¨í‚¤ì§€ëŠ” Expo í”„ë¡œì íŠ¸ì—ì„œ SQLite ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.


#### 3ë‹¨ê³„ - í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜í•˜ê¸°

<Npm>
  drizzle-orm
  -D drizzle-kit
</Npm>

ìœ„ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ `drizzle-orm`ê³¼ `drizzle-kit` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. `drizzle-kit`ì€ ê°œë°œ ì˜ì¡´ì„±ìœ¼ë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤.


#### 4ë‹¨ê³„ - Drizzle ORMì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ê¸°

ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— `App.tsx` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤:

```ts
import * as SQLite from 'expo-sqlite';
import { drizzle } from 'drizzle-orm/expo-sqlite';

const expo = SQLite.openDatabaseSync('db.db');

const db = drizzle(expo);
```

ì´ ì½”ë“œëŠ” Expo SQLiteë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ì„ ì—´ê³ , Drizzle ORMì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. `db` ê°ì²´ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


#### 4ë‹¨ê³„ - í…Œì´ë¸” ìƒì„±í•˜ê¸°

`db` ë””ë ‰í† ë¦¬ì— `schema.ts` íŒŒì¼ì„ ìƒì„±í•˜ê³  í…Œì´ë¸”ì„ ì„ ì–¸í•©ë‹ˆë‹¤:

```typescript
import { int, sqliteTable, text } from "drizzle-orm/sqlite-core";

export const usersTable = sqliteTable("users_table", {
  id: int().primaryKey({ autoIncrement: true }),  // ìë™ ì¦ê°€í•˜ëŠ” ê¸°ë³¸ í‚¤
  name: text().notNull(),                         // ì´ë¦„ (í•„ìˆ˜)
  age: int().notNull(),                           // ë‚˜ì´ (í•„ìˆ˜)
  email: text().notNull().unique(),               // ì´ë©”ì¼ (í•„ìˆ˜, ê³ ìœ ê°’)
});
```

ì´ ì½”ë“œëŠ” SQLite ë°ì´í„°ë² ì´ìŠ¤ì— `users_table`ì´ë¼ëŠ” í…Œì´ë¸”ì„ ì •ì˜í•©ë‹ˆë‹¤. í…Œì´ë¸”ì€ `id`, `name`, `age`, `email` ì»¬ëŸ¼ìœ¼ë¡œ êµ¬ì„±ë˜ë©°, ê° ì»¬ëŸ¼ì€ íƒ€ì…ê³¼ ì œì•½ ì¡°ê±´ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.


#### 5ë‹¨ê³„ - Drizzle ì„¤ì • íŒŒì¼ ì„¤ì •í•˜ê¸°

**Drizzle ì„¤ì • íŒŒì¼** - [Drizzle Kit](/docs/kit-overview)ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì„¤ì • íŒŒì¼ë¡œ, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´, ë§ˆì´ê·¸ë ˆì´ì…˜ í´ë”, ìŠ¤í‚¤ë§ˆ íŒŒì¼ ë“±ì— ëŒ€í•œ ëª¨ë“  ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `drizzle.config.ts` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•˜ì„¸ìš”:

```ts
import { defineConfig } from 'drizzle-kit';

export default defineConfig({
  dialect: 'sqlite', // ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ ì„¤ì • (SQLite ì‚¬ìš©)
  driver: 'expo', // ë“œë¼ì´ë²„ ì„¤ì • (Expo ì‚¬ìš©)
  schema: './db/schema.ts', // ìŠ¤í‚¤ë§ˆ íŒŒì¼ ê²½ë¡œ
  out: './drizzle', // ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì´ ìƒì„±ë  ê²½ë¡œ
});
```

ì´ ì„¤ì • íŒŒì¼ì€ Drizzle Kitì´ ë°ì´í„°ë² ì´ìŠ¤ì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ë° í•„ìš”í•œ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. `dialect`ëŠ” ì‚¬ìš©í•  ë°ì´í„°ë² ì´ìŠ¤ ì¢…ë¥˜ë¥¼, `driver`ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•  ë•Œ ì‚¬ìš©í•  ë“œë¼ì´ë²„ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. `schema`ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆê°€ ì •ì˜ëœ íŒŒì¼ì˜ ê²½ë¡œë¥¼, `out`ì€ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì´ ì €ì¥ë  ê²½ë¡œë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.


#### 6ë‹¨ê³„ - `metro` ì„¤ì •í•˜ê¸°

ë£¨íŠ¸ í´ë”ì— `metro.config.js` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤:

```js
const { getDefaultConfig } = require('expo/metro-config');
/** @type {import('expo/metro-config').MetroConfig} */
const config = getDefaultConfig(__dirname);
config.resolver.sourceExts.push('sql');
module.exports = config;
```

ì´ ì½”ë“œëŠ” Expoì˜ ê¸°ë³¸ Metro ì„¤ì •ì„ ê°€ì ¸ì™€ì„œ SQL íŒŒì¼ í™•ì¥ìë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •ì„ í™•ì¥í•©ë‹ˆë‹¤.


#### 7ë‹¨ê³„ - `babel` ì„¤ì • ì—…ë°ì´íŠ¸

```js copy filename="babel.config.js"
module.exports = function(api) {
  api.cache(true);
  return {
    presets: ['babel-preset-expo'],
    plugins: [["inline-import", { "extensions": [".sql"] }]] // <-- ì´ ë¶€ë¶„ ì¶”ê°€
  };
};
```


#### 8ë‹¨ê³„ - ë°ì´í„°ë² ì´ìŠ¤ì— ë³€ê²½ ì‚¬í•­ ì ìš©í•˜ê¸°

Expoë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” `drizzle-kit generate` ì»¤ë§¨ë“œë¥¼ í†µí•´ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìƒì„±í•œ í›„, `drizzle-orm`ì˜ `migrate()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ëŸ°íƒ€ì„ì— ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±í•˜ê¸°:
```bash
npx drizzle-kit generate
```


#### 9ë‹¨ê³„ - ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© ë° ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬í•˜ê¸°:

**App.tsx** íŒŒì¼ì— ë§ˆì´ê·¸ë ˆì´ì…˜ê³¼ ì‚¬ìš©ì ìƒì„±, ì½ê¸°, ì—…ë°ì´íŠ¸, ì‚­ì œë¥¼ ìœ„í•œ ì¿¼ë¦¬ë¥¼ ì¶”ê°€í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```tsx
import { Text, View } from 'react-native';
import * as SQLite from 'expo-sqlite';
import { useEffect, useState } from 'react';
import { drizzle } from 'drizzle-orm/expo-sqlite';
import { usersTable } from './db/schema';
import { useMigrations } from 'drizzle-orm/expo-sqlite/migrator';
import migrations from './drizzle/migrations';

const expo = SQLite.openDatabaseSync('db.db');

const db = drizzle(expo);

export default function App() {
  const { success, error } = useMigrations(db, migrations);
  const [items, setItems] = useState(null);

  useEffect(() => {
    if (!success) return;

    (async () => {
      await db.delete(usersTable);

      await db.insert(usersTable).values([
        {
          name: 'John',
          age: 30,
          email: 'john@example.com',
        },
      ]);

      const users = await db.select().from(usersTable);
      setItems(users);
    })();
  }, [success]);

  if (error) {
    return (
      <View>
        <Text>ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜: {error.message}</Text>
      </View>
    );
  }

  if (!success) {
    return (
      <View>
        <Text>ë§ˆì´ê·¸ë ˆì´ì…˜ ì§„í–‰ ì¤‘...</Text>
      </View>
    );
  }

  if (items === null || items.length === 0) {
    return (
      <View>
        <Text>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</Text>
      </View>
    );
  }

  return (
    <View
      style={{
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        width: '100%',
        height: '100%',
        justifyContent: 'center',
      }}
    >
      {items.map((item) => (
        <Text key={item.email}>{item.email}</Text>
      ))}
    </View>
  );
}
```

ì´ ì½”ë“œëŠ” SQLite ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” ê°„ë‹¨í•œ ì˜ˆì œì…ë‹ˆë‹¤. ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì ìš©í•˜ê³ , ì‚¬ìš©ì ë°ì´í„°ë¥¼ ìƒì„±, ì‚­ì œ, ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.


#### 10ë‹¨ê³„ - Expo ì•± ì‚¬ì „ ë¹Œë“œ ë° ì‹¤í–‰

<CodeTabs items={['npm', 'yarn', 'pnpm', 'bun']}>
```bash copy
npx expo run:ios
```
```bash copy
yarn expo run:ios
```
```bash copy
pnpm expo run:ios
```
```bash copy
bun expo run:ios
```
</CodeTabs>


